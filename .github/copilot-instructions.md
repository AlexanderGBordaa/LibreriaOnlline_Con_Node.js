# Copilot instructions for Librería Cristiana

This project is a small static front-end served optionally with a Node/Express development server. The goal of these instructions is to give an AI code assistant the exact, project-specific knowledge to be productive quickly.

## Big picture
- Files of interest:
  - `index.html` — main single-page layout: header, search form, `#libros` section with `#libros-list`, and `#visor` PDF viewer.
  - `style.css` — all visual styling; contains estante (shelf) styles, `.book-card`, `.book-info` and UI skin.
  - `web.js` — client-side logic: fetches `/api/books`, renders book cards, search input handling, and PDF viewer controls.
  - `server.js` — simple Express server that serves static files and provides `/api/books` to return `data/books.json`.
  - `data/books.json` — canonical list of books the UI consumes via the API.
  - `admin.html` / `admin.js` — simple admin UI to add books and videos (protected client-side + server-side token verification).
  - `data/videos.json` — list of videos used by the site and by the videos page.

- Runtime: development uses Node.js + Express. The project serves static files from the repository root. Use `npm run dev` (nodemon) for development, `npm start` for production.

Security & auth: The project supports Google Sign-In (client) and server-side ID token verification. Set `GOOGLE_CLIENT_ID` in the server environment to enable verification of ID tokens when creating content via the admin UI.

## Useful commands
- Install dependencies:

```powershell
npm install
```

- Start dev server (auto-restart):

```powershell
npm run dev
```

- Start production server:

```powershell
npm start
```

The server listens on `http://localhost:3000` by default.

## Project-specific conventions & patterns
- Data-driven UI: `data/books.json` is the single source of truth for the book list. `web.js` fetches `/api/books` and stores data into local arrays `libros` and `librosFiltrados` for rendering and search.
- DOM targets:
  - `#libros-list` — container where `.book-card` elements are appended.
  - `#busqueda-input` — search input used to filter `libros` client-side.
  - `#visor-pdf` — iframe used to display the `.pdf` link from a book object.
- CSS structure:
  - Shelf visuals: `.estante-madera`, `.estante-superior`, `.estante-libros`.
  - Book card structure: `.book-card` contains `.book-info` and inside it `.book-title`, `p` and `button`.
- Event behavior:
  - Clicking a `.book-card` (except on its button) opens the viewer via `verPDF(idx)`.
  - The `Leer PDF` button also triggers viewing; UI body toggles `#libros` and `#visor` visibility.

## When editing UI or adding features
- Prefer adding new style classes rather than modifying core `.book-card` rules to avoid regressions.
- If you add new endpoints to `server.js`, return JSON only (the front-end expects `/api/books` to return an array of book objects).
- Keep `data/books.json` in sync with any server-side / build-time transformations.
 - Protected endpoints: POST `/api/books` and POST `/api/videos` are protected and require a valid Google ID token (send as `Authorization: Bearer <id_token>`). The server verifies tokens using Google's tokeninfo endpoint and compares the `aud` to `GOOGLE_CLIENT_ID`.

## Examples & code snippets (from project)
- Client fetch call (in `web.js`):

```js
const res = await fetch('/api/books');
libros = await res.json();
```

- Card DOM structure generated by `web.js`:

```html
<div class="book-card">
  <div class="book-info">
    <h3 class="book-title">TÍTULO</h3>
    <p><strong>Autor:</strong> AUTOR</p>
    <button onclick="verPDF(INDEX)">Leer PDF</button>
  </div>
</div>
```

## Debugging tips
- If books do not load, verify `/api/books` in the browser (open network tab or visit http://localhost:3000/api/books).
 - If admin POST endpoints fail with 401, ensure `GOOGLE_CLIENT_ID` is exported in the server environment and that the client sent a valid `id_token` in the Authorization header.
- Cross-origin PDFs: the viewer uses an `iframe` with the raw PDF URL. Some hosts (Google Drive, certain servers) block embedding — test PDFs in a browser first.
- When changing the look-and-feel, refresh the browser cache or open in incognito to ensure new CSS is loaded.

## Things the AI should not do
- Remove `data/books.json` or hardcode book arrays back into the client.
- Replace the simple Express server with a heavy framework without explicit instruction.

## Follow-ups
- Ask the maintainer before adding persistent storage or a build pipeline (there's currently none).

If anything here is unclear or you want extra examples (e.g., adding tests, CI, or a small build step), tell me what to expand.
